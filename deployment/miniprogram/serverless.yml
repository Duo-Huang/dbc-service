# Miniprogram 服务配置
# 使用 SCF CLI 部署: scf deploy

component: scf
name: dbc-miniprogram
org: qypeak
app: dbc
stage: dev

inputs:
    name: dbc-miniprogram
    type: web
    src:
        src: ../../dist/apps/miniprogram
        exclude:
            - .env
    runtime: Nodejs20.19
    region: ${{ env:REGION }}
    memorySize: 512
    timeout: 30
    environment:
        variables:
            NODE_ENV: production
            TZ: Asia/Shanghai
            MINIPROGRAM_SERVER_PORT: 9000
            MINIPROGRAM_DB_HOST: ${{ env:MINIPROGRAM_DB_HOST }}
            MINIPROGRAM_DB_PORT: ${{ env:MINIPROGRAM_DB_PORT }}
            MINIPROGRAM_DB_NAME: ${{ env:MINIPROGRAM_DB_NAME }}
            MINIPROGRAM_DB_SCHEMA: ${{ env:MINIPROGRAM_DB_SCHEMA }}
            MINIPROGRAM_DB_USER: ${{ env:MINIPROGRAM_DB_USER }}
            MINIPROGRAM_DB_PASSWORD: ${{ env:MINIPROGRAM_DB_PASSWORD }}
    layers:
        - name: ${output:${stage}:${app}:dbc-deps-layer.name}
          version: ${output:${stage}:${app}:dbc-deps-layer.version}
    events:
        - http:
              parameters:
                  netConfig:
                      enableIntranet: true
                      enableExtranet: true
                  qualifier: $DEFAULT
                  authType: NONE
