# Serverless Framework 配置文件 - Miniapp 应用
# 用于部署到腾讯云 Serverless

service: dbc-miniapp

provider:
    name: tencent
    runtime: Nodejs22.20.0
    region: ap-chengdu # 可选: ap-shanghai, ap-beijing, ap-chengdu 等
    credentials: ~/.tencent/credentials # 腾讯云凭证路径

plugins:
    - serverless-tencent-scf

functions:
    miniapp:
        description: DBC Miniapp 小程序后端
        memorySize: 512 # MB, 可选值: 128, 256, 512, 1024, 1536, 3072
        timeout: 30 # 秒
        environment:
            NODE_ENV: production
            SERVER_MINIAPP_PORT: 9000
        events:
            - apigw:
                  name: miniapp-api
                  parameters:
                      serviceId: # 可选，已有 API 网关服务 ID
                      protocols:
                          - http
                          - https
                      serviceName: dbc-miniapp-api
                      description: DBC Miniapp API Gateway
                      environment: release
                      endpoints:
                          - path: /
                            method: ANY
                            description: Miniapp 应用所有路由
        package:
            artifact: ../../serverless_package/miniapp.zip

# 自定义配置
custom:
    # 腾讯云账号配置
    tencent:
        # 从环境变量读取
        secretId: ${env:TENCENT_SECRET_ID}
        secretKey: ${env:TENCENT_SECRET_KEY}
# 使用说明:
# 1. 配置腾讯云凭证
#    export TENCENT_SECRET_ID=your-secret-id
#    export TENCENT_SECRET_KEY=your-secret-key
#
# 2. 部署
#    cd deployment/miniapp
#    serverless deploy --stage prod
#
# 3. 查看部署信息
#    serverless info
#
# 4. 查看日志
#    serverless logs -f miniapp
#
# 5. 删除服务
#    serverless remove

